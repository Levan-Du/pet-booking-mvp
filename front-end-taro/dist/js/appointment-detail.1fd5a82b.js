var e=(e,s,a)=>new Promise((n,c)=>{var l=e=>{try{i(a.next(e))}catch(s){c(s)}},t=e=>{try{i(a.throw(e))}catch(s){c(s)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,t);i((a=a.apply(e,s)).next())});import{R as s,j as a,V as n,T as c,q as l,v as t,t as i,E as r,p as m}from"./vendors.680e87f1.js";import{u as o,C as d,f as p,a as h,A as x}from"./common.0ee540b1.js";const j=()=>{const{t:j}=o(),[N,u]=s.useState(null),[v,f]=s.useState(""),[g,_]=s.useState(!0),b=()=>{var e;const s=null==(e=m().router)?void 0:e.params;return(null==s?void 0:s.id)||""},w=()=>e(void 0,null,function*(){const e=b();if(!e)return t({title:"\u9884\u7ea6ID\u65e0\u6548",icon:"error"}),void i.navigateBack();_(!0);try{const s=yield h({url:`${x.USERS_APPOINTMENTS_URL}/${e}`,method:"GET"});s.data.success&&(u(s.data.data),f(`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=appointment:${e}`))}catch(s){t({title:j("management.loadFailed")||"\u52a0\u8f7d\u5931\u8d25",icon:"error"})}finally{_(!1)}}),y=e=>j(`petTypes.${e}`)||e,T=e=>{const s={pending:j("management.pending"),confirmed:j("management.confirmed"),in_progress:j("management.in_progress"),completed:j("management.completed"),cancelled:j("management.cancelled"),broken:j("management.broken")};return s[e]||e},q=()=>!!N&&["pending","confirmed"].includes(N.status),S=()=>e(void 0,null,function*(){if(N)try{const e=yield r({title:j("common.confirm")||"\u786e\u8ba4",content:j("appointment.cancelConfirm")||"\u786e\u5b9a\u8981\u53d6\u6d88\u6b64\u9884\u7ea6\u5417\uff1f\u6b64\u64cd\u4f5c\u4e0d\u53ef\u64a4\u9500\u3002",confirmText:j("common.confirm")||"\u786e\u8ba4",cancelText:j("common.cancel")||"\u53d6\u6d88"});if(e.confirm){_(!0);const e=yield h({url:`${x.USERS_APPOINTMENTS_URL}/${N._id}/status`,method:"PUT",data:{status:"cancelled"}});e.data.success?(t({title:j("appointment.cancelSuccess")||"\u9884\u7ea6\u53d6\u6d88\u6210\u529f",icon:"success"}),w()):t({title:e.data.message||j("appointment.cancelFailed")||"\u53d6\u6d88\u9884\u7ea6\u5931\u8d25",icon:"error"})}}catch(e){t({title:j("appointment.cancelFailed")||"\u53d6\u6d88\u9884\u7ea6\u5931\u8d25",icon:"error"})}finally{_(!1)}});return s.useEffect(()=>{w()},[]),g?a.jsxs(n,{className:"layout page-apm-detail",children:[a.jsx(d,{title:j("nav.booking")||"\u9884\u7ea6\u8be6\u60c5"}),a.jsx(n,{className:"loading",children:a.jsx(c,{children:j("common.loading")||"\u52a0\u8f7d\u4e2d..."})})]}):N?a.jsxs(n,{className:"layout page-apm-detail",children:[a.jsx(d,{title:j("nav.booking")||"\u9884\u7ea6\u8be6\u60c5",showLog:!1,showReports:!1}),a.jsx(n,{className:"container",children:a.jsxs(n,{className:"content-container",children:[a.jsxs(n,{className:"info-card card",children:[a.jsxs(n,{className:"card-header",children:[a.jsx(c,{className:"service-name",children:N.service_name}),a.jsxs(n,{className:"header-right",children:[q()&&a.jsx(n,{className:"cancel-btn-small",onClick:S,children:a.jsx(c,{children:j("appointment.cancel")||"\u53d6\u6d88\u9884\u7ea6"})}),a.jsx(n,{className:`status-badge ${N.status}`,children:T(N.status)})]})]}),a.jsxs(n,{className:"card-content",children:[a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("appointment.appointmentNo")||"\u9884\u7ea6\u5355\u53f7",":"]}),a.jsx(c,{className:"value",children:N.appointment_no})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("management.customer")||"\u5ba2\u6237",":"]}),a.jsx(c,{className:"value",children:N.customer_name})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("management.phone")||"\u7535\u8bdd",":"]}),a.jsx(c,{className:"value",children:N.customer_phone})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("management.pet")||"\u5ba0\u7269",":"]}),a.jsxs(c,{className:"value",children:[y(N.pet_type)," \xb7",N.pet_breed||j("common.unknown")||"\u672a\u77e5"," \xb7",N.pet_size]})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("appointment.serviceItem")||"\u670d\u52a1\u9879\u76ee",":"]}),a.jsx(c,{className:"value",children:N.service_name})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("appointment.serviceDuration")||"\u670d\u52a1\u65f6\u957f",":"]}),a.jsxs(c,{className:"value",children:[N.duration,j("appointment.minutes")||"\u5206\u949f"]})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("appointment.servicePrice")||"\u670d\u52a1\u4ef7\u683c",":"]}),a.jsxs(c,{className:"value",children:["\xa5",N.price]})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("management.time")||"\u65f6\u95f4",":"]}),a.jsxs(c,{className:"value",children:[p(new Date(N.appointment_date))," ",N.appointment_time]})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("appointment.estimatedEndTime")||"\u9884\u8ba1\u7ed3\u675f\u65f6\u95f4",":"]}),a.jsx(c,{className:"value",children:N.end_time})]}),a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("appointment.createTime")||"\u521b\u5efa\u65f6\u95f4",":"]}),a.jsx(c,{className:"value",children:p(new Date(N.created_at))})]}),N.special_notes&&a.jsxs(n,{className:"info-row",children:[a.jsxs(c,{className:"label",children:[j("management.notes")||"\u5907\u6ce8",":"]}),a.jsx(c,{className:"value notes",children:N.special_notes})]})]})]}),a.jsxs(n,{className:"qr-card card",children:[a.jsx(c,{className:"qr-title",children:j("appointment.qrTitle")||"\u9884\u7ea6\u4e8c\u7ef4\u7801"}),a.jsx(c,{className:"qr-desc",children:j("appointment.qrDesc")||"\u5230\u5e97\u540e\u8bf7\u5411\u5546\u5bb6\u51fa\u793a\u6b64\u4e8c\u7ef4\u7801\u8fdb\u884c\u7b7e\u5230"}),v&&a.jsx(n,{className:"qr-code-container",children:a.jsx(l,{src:v,className:"qr-code"})}),a.jsx(c,{className:"qr-tip",children:j("appointment.qrTip")||'\u5546\u5bb6\u626b\u63cf\u4e8c\u7ef4\u7801\u540e\uff0c\u9884\u7ea6\u72b6\u6001\u5c06\u66f4\u65b0\u4e3a"\u8fdb\u884c\u4e2d"'})]})]})})]}):a.jsxs(n,{className:"layout page-apm-detail",children:[a.jsx(d,{title:j("nav.booking")||"\u9884\u7ea6\u8be6\u60c5"}),a.jsx(n,{className:"error",children:a.jsx(c,{children:"\u9884\u7ea6\u4fe1\u606f\u4e0d\u5b58\u5728"})})]})};export{j as default};
